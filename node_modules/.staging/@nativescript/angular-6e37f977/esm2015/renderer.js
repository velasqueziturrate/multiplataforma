import { __decorate } from "tslib";
import { Injectable, NgZone, Renderer2 } from '@angular/core';
import { View, getViewById, profile } from '@nativescript/core';
import { ViewUtil } from './view-util';
import { NativeScriptDebug } from './trace';
export class NativeScriptRenderer extends Renderer2 {
    constructor(rootView, zone, viewUtil) {
        super();
        this.rootView = rootView;
        this.zone = zone;
        this.viewUtil = viewUtil;
        this.data = Object.create(null);
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog('NativeScriptRenderer created');
        }
    }
    appendChild(parent, newChild) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.appendChild child: ${newChild} parent: ${parent}`);
        }
        this.viewUtil.insertChild(parent, newChild);
    }
    insertBefore(parent, newChild, { previous, next }) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.insertBefore child: ${newChild} ` + `parent: ${parent} previous: ${previous} next: ${next}`);
        }
        this.viewUtil.insertChild(parent, newChild, previous, next);
    }
    removeChild(parent, oldChild) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.removeChild child: ${oldChild} parent: ${parent}`);
        }
        this.viewUtil.removeChild(parent, oldChild);
    }
    selectRootElement(selector) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.selectRootElement: ${selector}`);
        }
        if (selector && selector[0] === '#') {
            const result = getViewById(this.rootView, selector.slice(1));
            return (result || this.rootView);
        }
        return this.rootView;
    }
    parentNode(node) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.parentNode for node: ${node} is ${node.parentNode}`);
        }
        return node.parentNode;
    }
    nextSibling(node) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.nextSibling of ${node} is ${node.nextSibling}`);
        }
        return {
            previous: node,
            next: node.nextSibling,
        };
    }
    createComment(_value) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.createComment ${_value}`);
        }
        return this.viewUtil.createComment();
    }
    createElement(name, _namespace) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.createElement: ${name}`);
        }
        return this.viewUtil.createView(name);
    }
    createText(_value) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.createText ${_value}`);
        }
        return this.viewUtil.createText();
    }
    createViewRoot(hostElement) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.createViewRoot ${hostElement.nodeName}`);
        }
        return hostElement;
    }
    projectNodes(parentElement, nodes) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog('NativeScriptRenderer.projectNodes');
        }
        nodes.forEach((node) => this.viewUtil.insertChild(parentElement, node));
    }
    destroy() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog('NativeScriptRenderer.destroy');
        }
        // Seems to be called on component dispose only (router outlet)
        // TODO: handle this when we resolve routing and navigation.
    }
    setAttribute(view, name, value, namespace) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.setAttribute ${view} : ${name} = ${value}, namespace: ${namespace}`);
        }
        return this.viewUtil.setProperty(view, name, value, namespace);
    }
    removeAttribute(_el, _name) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.removeAttribute ${_el}: ${_name}`);
        }
    }
    setProperty(view, name, value) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.setProperty ${view} : ${name} = ${value}`);
        }
        return this.viewUtil.setProperty(view, name, value);
    }
    addClass(view, name) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.addClass ${name}`);
        }
        this.viewUtil.addClass(view, name);
    }
    removeClass(view, name) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.removeClass ${name}`);
        }
        this.viewUtil.removeClass(view, name);
    }
    setStyle(view, styleName, value, _flags) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.setStyle: ${styleName} = ${value}`);
        }
        this.viewUtil.setStyle(view, styleName, value);
    }
    removeStyle(view, styleName, _flags) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog('NativeScriptRenderer.removeStyle: ${styleName}');
        }
        this.viewUtil.removeStyle(view, styleName);
    }
    // Used only in debug mode to serialize property changes to comment nodes,
    // such as <template> placeholders.
    setBindingDebugInfo(renderElement, propertyName, propertyValue) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.setBindingDebugInfo: ${renderElement}, ${propertyName} = ${propertyValue}`);
        }
    }
    setElementDebugInfo(renderElement, _info /*RenderDebugInfo*/) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.setElementDebugInfo: ${renderElement}`);
        }
    }
    invokeElementMethod(_renderElement, methodName, args) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.invokeElementMethod ${methodName} ${args}`);
        }
    }
    setValue(_renderNode, _value) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.setValue renderNode: ${_renderNode}, value: ${_value}`);
        }
    }
    listen(renderElement, eventName, callback) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.rendererLog(`NativeScriptRenderer.listen: ${eventName}`);
        }
        // Explicitly wrap in zone
        let zonedCallback = (...args) => {
            this.zone.run(() => {
                callback.apply(undefined, args);
            });
        };
        renderElement.on(eventName, zonedCallback);
        if (eventName === View.loadedEvent && renderElement.isLoaded) {
            const notifyData = { eventName: View.loadedEvent, object: renderElement };
            zonedCallback(notifyData);
        }
        return () => renderElement.off(eventName, zonedCallback);
    }
}
NativeScriptRenderer.decorators = [
    { type: Injectable }
];
NativeScriptRenderer.ctorParameters = () => [
    { type: undefined },
    { type: NgZone },
    { type: ViewUtil }
];
__decorate([
    profile
], NativeScriptRenderer.prototype, "appendChild", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "insertBefore", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "removeChild", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "selectRootElement", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "parentNode", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "nextSibling", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "createComment", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "createElement", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "createText", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "createViewRoot", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "projectNodes", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "destroy", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "setAttribute", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "removeAttribute", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "setProperty", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "addClass", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "removeClass", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "setStyle", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "removeStyle", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "setBindingDebugInfo", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "setElementDebugInfo", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "invokeElementMethod", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "setValue", null);
__decorate([
    profile
], NativeScriptRenderer.prototype, "listen", null);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9yZW5kZXJlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFVLFVBQVUsRUFBWSxNQUFNLEVBQUUsU0FBUyxFQUEyRSxNQUFNLGVBQWUsQ0FBQztBQUV6SixPQUFPLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVoRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXZDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQVE1QyxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsU0FBUztJQUdsRCxZQUFvQixRQUFnQixFQUFVLElBQVksRUFBVSxRQUFrQjtRQUNyRixLQUFLLEVBQUUsQ0FBQztRQURXLGFBQVEsR0FBUixRQUFRLENBQVE7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFRO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUZ0RixTQUFJLEdBQTJCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFJbEQsSUFBSSxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsRUFBRTtZQUNyQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsOEJBQThCLENBQUMsQ0FBQztTQUM5RDtJQUNGLENBQUM7SUFHRCxXQUFXLENBQUMsTUFBYyxFQUFFLFFBQWdCO1FBQzNDLElBQUksaUJBQWlCLENBQUMsWUFBWSxFQUFFLEVBQUU7WUFDckMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLDJDQUEyQyxRQUFRLFlBQVksTUFBTSxFQUFFLENBQUMsQ0FBQztTQUN2RztRQUNELElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBR0QsWUFBWSxDQUFDLE1BQWMsRUFBRSxRQUFnQixFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUks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SUFEQyxPQUFPO21EQU9QO0FBR0Q7SUFEQyxPQUFPO3dEQU1QO0FBR0Q7SUFEQyxPQUFPOzJEQUtQO0FBR0Q7SUFEQyxPQUFPO3VEQU1QO0FBR0Q7SUFEQyxPQUFPO29EQU1QO0FBR0Q7SUFEQyxPQUFPO3VEQU1QO0FBR0Q7SUFEQyxPQUFPO29EQU1QO0FBR0Q7SUFEQyxPQUFPO3VEQU1QO0FBS0Q7SUFEQyxPQUFPOytEQUtQO0FBR0Q7SUFEQyxPQUFPOytEQUtQO0FBR0Q7SUFEQyxPQUFPOytEQUtQO0FBR0Q7SUFEQyxPQUFPO29EQUtQO0FBR0Q7SUFEQyxPQUFPO2tEQWtCUCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgT3B0aW9uYWwsIE5nWm9uZSwgUmVuZGVyZXIyLCBSZW5kZXJlckZhY3RvcnkyLCBSZW5kZXJlclR5cGUyLCBSZW5kZXJlclN0eWxlRmxhZ3MyLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBWaWV3LCBnZXRWaWV3QnlJZCwgcHJvZmlsZSB9IGZyb20gJ0BuYXRpdmVzY3JpcHQvY29yZSc7XG5cbmltcG9ydCB7IFZpZXdVdGlsIH0gZnJvbSAnLi92aWV3LXV0aWwnO1xuaW1wb3J0IHsgTmdWaWV3LCBJbnZpc2libGVOb2RlIH0gZnJvbSAnLi9lbGVtZW50LXJlZ2lzdHJ5JztcbmltcG9ydCB7IE5hdGl2ZVNjcmlwdERlYnVnIH0gZnJvbSAnLi90cmFjZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRWxlbWVudFJlZmVyZW5jZSB7XG5cdHByZXZpb3VzOiBOZ1ZpZXc7XG5cdG5leHQ6IE5nVmlldztcbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE5hdGl2ZVNjcmlwdFJlbmRlcmVyIGV4dGVuZHMgUmVuZGVyZXIyIHtcblx0ZGF0YTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cblx0Y29uc3RydWN0b3IocHJpdmF0ZSByb290VmlldzogTmdWaWV3LCBwcml2YXRlIHpvbmU6IE5nWm9uZSwgcHJpdmF0ZSB2aWV3VXRpbDogVmlld1V0aWwpIHtcblx0XHRzdXBlcigpO1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coJ05hdGl2ZVNjcmlwdFJlbmRlcmVyIGNyZWF0ZWQnKTtcblx0XHR9XG5cdH1cblxuXHRAcHJvZmlsZVxuXHRhcHBlbmRDaGlsZChwYXJlbnQ6IE5nVmlldywgbmV3Q2hpbGQ6IE5nVmlldyk6IHZvaWQge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coYE5hdGl2ZVNjcmlwdFJlbmRlcmVyLmFwcGVuZENoaWxkIGNoaWxkOiAke25ld0NoaWxkfSBwYXJlbnQ6ICR7cGFyZW50fWApO1xuXHRcdH1cblx0XHR0aGlzLnZpZXdVdGlsLmluc2VydENoaWxkKHBhcmVudCwgbmV3Q2hpbGQpO1xuXHR9XG5cblx0QHByb2ZpbGVcblx0aW5zZXJ0QmVmb3JlKHBhcmVudDogTmdWaWV3LCBuZXdDaGlsZDogTmdWaWV3LCB7IHByZXZpb3VzLCBuZXh0IH06IEVsZW1lbnRSZWZlcmVuY2UpOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJlbmRlcmVyTG9nKGBOYXRpdmVTY3JpcHRSZW5kZXJlci5pbnNlcnRCZWZvcmUgY2hpbGQ6ICR7bmV3Q2hpbGR9IGAgKyBgcGFyZW50OiAke3BhcmVudH0gcHJldmlvdXM6ICR7cHJldmlvdXN9IG5leHQ6ICR7bmV4dH1gKTtcblx0XHR9XG5cdFx0dGhpcy52aWV3VXRpbC5pbnNlcnRDaGlsZChwYXJlbnQsIG5ld0NoaWxkLCBwcmV2aW91cywgbmV4dCk7XG5cdH1cblxuXHRAcHJvZmlsZVxuXHRyZW1vdmVDaGlsZChwYXJlbnQ6IGFueSwgb2xkQ2hpbGQ6IE5nVmlldyk6IHZvaWQge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coYE5hdGl2ZVNjcmlwdFJlbmRlcmVyLnJlbW92ZUNoaWxkIGNoaWxkOiAke29sZENoaWxkfSBwYXJlbnQ6ICR7cGFyZW50fWApO1xuXHRcdH1cblx0XHR0aGlzLnZpZXdVdGlsLnJlbW92ZUNoaWxkKHBhcmVudCwgb2xkQ2hpbGQpO1xuXHR9XG5cblx0QHByb2ZpbGVcblx0c2VsZWN0Um9vdEVsZW1lbnQoc2VsZWN0b3I6IHN0cmluZyk6IE5nVmlldyB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZyhgTmF0aXZlU2NyaXB0UmVuZGVyZXIuc2VsZWN0Um9vdEVsZW1lbnQ6ICR7c2VsZWN0b3J9YCk7XG5cdFx0fVxuXHRcdGlmIChzZWxlY3RvciAmJiBzZWxlY3RvclswXSA9PT0gJyMnKSB7XG5cdFx0XHRjb25zdCByZXN1bHQgPSBnZXRWaWV3QnlJZCh0aGlzLnJvb3RWaWV3LCBzZWxlY3Rvci5zbGljZSgxKSk7XG5cdFx0XHRyZXR1cm4gKHJlc3VsdCB8fCB0aGlzLnJvb3RWaWV3KSBhcyBOZ1ZpZXc7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLnJvb3RWaWV3O1xuXHR9XG5cblx0QHByb2ZpbGVcblx0cGFyZW50Tm9kZShub2RlOiBOZ1ZpZXcpOiBhbnkge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coYE5hdGl2ZVNjcmlwdFJlbmRlcmVyLnBhcmVudE5vZGUgZm9yIG5vZGU6ICR7bm9kZX0gaXMgJHtub2RlLnBhcmVudE5vZGV9YCk7XG5cdFx0fVxuXHRcdHJldHVybiBub2RlLnBhcmVudE5vZGU7XG5cdH1cblxuXHRAcHJvZmlsZVxuXHRuZXh0U2libGluZyhub2RlOiBOZ1ZpZXcpOiBFbGVtZW50UmVmZXJlbmNlIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJlbmRlcmVyTG9nKGBOYXRpdmVTY3JpcHRSZW5kZXJlci5uZXh0U2libGluZyBvZiAke25vZGV9IGlzICR7bm9kZS5uZXh0U2libGluZ31gKTtcblx0XHR9XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0cHJldmlvdXM6IG5vZGUsXG5cdFx0XHRuZXh0OiBub2RlLm5leHRTaWJsaW5nLFxuXHRcdH07XG5cdH1cblxuXHRAcHJvZmlsZVxuXHRjcmVhdGVDb21tZW50KF92YWx1ZTogYW55KTogSW52aXNpYmxlTm9kZSB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZyhgTmF0aXZlU2NyaXB0UmVuZGVyZXIuY3JlYXRlQ29tbWVudCAke192YWx1ZX1gKTtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMudmlld1V0aWwuY3JlYXRlQ29tbWVudCgpO1xuXHR9XG5cblx0QHByb2ZpbGVcblx0Y3JlYXRlRWxlbWVudChuYW1lOiBhbnksIF9uYW1lc3BhY2U6IHN0cmluZyk6IE5nVmlldyB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZyhgTmF0aXZlU2NyaXB0UmVuZGVyZXIuY3JlYXRlRWxlbWVudDogJHtuYW1lfWApO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy52aWV3VXRpbC5jcmVhdGVWaWV3KG5hbWUpO1xuXHR9XG5cblx0QHByb2ZpbGVcblx0Y3JlYXRlVGV4dChfdmFsdWU6IHN0cmluZyk6IEludmlzaWJsZU5vZGUge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coYE5hdGl2ZVNjcmlwdFJlbmRlcmVyLmNyZWF0ZVRleHQgJHtfdmFsdWV9YCk7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLnZpZXdVdGlsLmNyZWF0ZVRleHQoKTtcblx0fVxuXG5cdEBwcm9maWxlXG5cdGNyZWF0ZVZpZXdSb290KGhvc3RFbGVtZW50OiBOZ1ZpZXcpOiBOZ1ZpZXcge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coYE5hdGl2ZVNjcmlwdFJlbmRlcmVyLmNyZWF0ZVZpZXdSb290ICR7aG9zdEVsZW1lbnQubm9kZU5hbWV9YCk7XG5cdFx0fVxuXHRcdHJldHVybiBob3N0RWxlbWVudDtcblx0fVxuXG5cdEBwcm9maWxlXG5cdHByb2plY3ROb2RlcyhwYXJlbnRFbGVtZW50OiBOZ1ZpZXcsIG5vZGVzOiBOZ1ZpZXdbXSk6IHZvaWQge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coJ05hdGl2ZVNjcmlwdFJlbmRlcmVyLnByb2plY3ROb2RlcycpO1xuXHRcdH1cblx0XHRub2Rlcy5mb3JFYWNoKChub2RlKSA9PiB0aGlzLnZpZXdVdGlsLmluc2VydENoaWxkKHBhcmVudEVsZW1lbnQsIG5vZGUpKTtcblx0fVxuXG5cdEBwcm9maWxlXG5cdGRlc3Ryb3koKSB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZygnTmF0aXZlU2NyaXB0UmVuZGVyZXIuZGVzdHJveScpO1xuXHRcdH1cblx0XHQvLyBTZWVtcyB0byBiZSBjYWxsZWQgb24gY29tcG9uZW50IGRpc3Bvc2Ugb25seSAocm91dGVyIG91dGxldClcblx0XHQvLyBUT0RPOiBoYW5kbGUgdGhpcyB3aGVuIHdlIHJlc29sdmUgcm91dGluZyBhbmQgbmF2aWdhdGlvbi5cblx0fVxuXG5cdEBwcm9maWxlXG5cdHNldEF0dHJpYnV0ZSh2aWV3OiBOZ1ZpZXcsIG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgbmFtZXNwYWNlPzogc3RyaW5nKSB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZyhgTmF0aXZlU2NyaXB0UmVuZGVyZXIuc2V0QXR0cmlidXRlICR7dmlld30gOiAke25hbWV9ID0gJHt2YWx1ZX0sIG5hbWVzcGFjZTogJHtuYW1lc3BhY2V9YCk7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLnZpZXdVdGlsLnNldFByb3BlcnR5KHZpZXcsIG5hbWUsIHZhbHVlLCBuYW1lc3BhY2UpO1xuXHR9XG5cblx0QHByb2ZpbGVcblx0cmVtb3ZlQXR0cmlidXRlKF9lbDogTmdWaWV3LCBfbmFtZTogc3RyaW5nKTogdm9pZCB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZyhgTmF0aXZlU2NyaXB0UmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlICR7X2VsfTogJHtfbmFtZX1gKTtcblx0XHR9XG5cdH1cblxuXHRAcHJvZmlsZVxuXHRzZXRQcm9wZXJ0eSh2aWV3OiBhbnksIG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSkge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coYE5hdGl2ZVNjcmlwdFJlbmRlcmVyLnNldFByb3BlcnR5ICR7dmlld30gOiAke25hbWV9ID0gJHt2YWx1ZX1gKTtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMudmlld1V0aWwuc2V0UHJvcGVydHkodmlldywgbmFtZSwgdmFsdWUpO1xuXHR9XG5cblx0QHByb2ZpbGVcblx0YWRkQ2xhc3ModmlldzogTmdWaWV3LCBuYW1lOiBzdHJpbmcpOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJlbmRlcmVyTG9nKGBOYXRpdmVTY3JpcHRSZW5kZXJlci5hZGRDbGFzcyAke25hbWV9YCk7XG5cdFx0fVxuXHRcdHRoaXMudmlld1V0aWwuYWRkQ2xhc3ModmlldywgbmFtZSk7XG5cdH1cblxuXHRAcHJvZmlsZVxuXHRyZW1vdmVDbGFzcyh2aWV3OiBOZ1ZpZXcsIG5hbWU6IHN0cmluZyk6IHZvaWQge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucmVuZGVyZXJMb2coYE5hdGl2ZVNjcmlwdFJlbmRlcmVyLnJlbW92ZUNsYXNzICR7bmFtZX1gKTtcblx0XHR9XG5cdFx0dGhpcy52aWV3VXRpbC5yZW1vdmVDbGFzcyh2aWV3LCBuYW1lKTtcblx0fVxuXG5cdEBwcm9maWxlXG5cdHNldFN0eWxlKHZpZXc6IE5nVmlldywgc3R5bGVOYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnksIF9mbGFncz86IFJlbmRlcmVyU3R5bGVGbGFnczIpOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJlbmRlcmVyTG9nKGBOYXRpdmVTY3JpcHRSZW5kZXJlci5zZXRTdHlsZTogJHtzdHlsZU5hbWV9ID0gJHt2YWx1ZX1gKTtcblx0XHR9XG5cdFx0dGhpcy52aWV3VXRpbC5zZXRTdHlsZSh2aWV3LCBzdHlsZU5hbWUsIHZhbHVlKTtcblx0fVxuXG5cdEBwcm9maWxlXG5cdHJlbW92ZVN0eWxlKHZpZXc6IE5nVmlldywgc3R5bGVOYW1lOiBzdHJpbmcsIF9mbGFncz86IFJlbmRlcmVyU3R5bGVGbGFnczIpOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJlbmRlcmVyTG9nKCdOYXRpdmVTY3JpcHRSZW5kZXJlci5yZW1vdmVTdHlsZTogJHtzdHlsZU5hbWV9Jyk7XG5cdFx0fVxuXHRcdHRoaXMudmlld1V0aWwucmVtb3ZlU3R5bGUodmlldywgc3R5bGVOYW1lKTtcblx0fVxuXG5cdC8vIFVzZWQgb25seSBpbiBkZWJ1ZyBtb2RlIHRvIHNlcmlhbGl6ZSBwcm9wZXJ0eSBjaGFuZ2VzIHRvIGNvbW1lbnQgbm9kZXMsXG5cdC8vIHN1Y2ggYXMgPHRlbXBsYXRlPiBwbGFjZWhvbGRlcnMuXG5cdEBwcm9maWxlXG5cdHNldEJpbmRpbmdEZWJ1Z0luZm8ocmVuZGVyRWxlbWVudDogTmdWaWV3LCBwcm9wZXJ0eU5hbWU6IHN0cmluZywgcHJvcGVydHlWYWx1ZTogc3RyaW5nKTogdm9pZCB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZyhgTmF0aXZlU2NyaXB0UmVuZGVyZXIuc2V0QmluZGluZ0RlYnVnSW5mbzogJHtyZW5kZXJFbGVtZW50fSwgJHtwcm9wZXJ0eU5hbWV9ID0gJHtwcm9wZXJ0eVZhbHVlfWApO1xuXHRcdH1cblx0fVxuXG5cdEBwcm9maWxlXG5cdHNldEVsZW1lbnREZWJ1Z0luZm8ocmVuZGVyRWxlbWVudDogYW55LCBfaW5mbzogYW55IC8qUmVuZGVyRGVidWdJbmZvKi8pOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJlbmRlcmVyTG9nKGBOYXRpdmVTY3JpcHRSZW5kZXJlci5zZXRFbGVtZW50RGVidWdJbmZvOiAke3JlbmRlckVsZW1lbnR9YCk7XG5cdFx0fVxuXHR9XG5cblx0QHByb2ZpbGVcblx0aW52b2tlRWxlbWVudE1ldGhvZChfcmVuZGVyRWxlbWVudDogTmdWaWV3LCBtZXRob2ROYW1lOiBzdHJpbmcsIGFyZ3M6IEFycmF5PGFueT4pIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJlbmRlcmVyTG9nKGBOYXRpdmVTY3JpcHRSZW5kZXJlci5pbnZva2VFbGVtZW50TWV0aG9kICR7bWV0aG9kTmFtZX0gJHthcmdzfWApO1xuXHRcdH1cblx0fVxuXG5cdEBwcm9maWxlXG5cdHNldFZhbHVlKF9yZW5kZXJOb2RlOiBhbnksIF92YWx1ZTogc3RyaW5nKSB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZyhgTmF0aXZlU2NyaXB0UmVuZGVyZXIuc2V0VmFsdWUgcmVuZGVyTm9kZTogJHtfcmVuZGVyTm9kZX0sIHZhbHVlOiAke192YWx1ZX1gKTtcblx0XHR9XG5cdH1cblxuXHRAcHJvZmlsZVxuXHRsaXN0ZW4ocmVuZGVyRWxlbWVudDogYW55LCBldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2s6IChldmVudDogYW55KSA9PiBib29sZWFuKTogKCkgPT4gdm9pZCB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yZW5kZXJlckxvZyhgTmF0aXZlU2NyaXB0UmVuZGVyZXIubGlzdGVuOiAke2V2ZW50TmFtZX1gKTtcblx0XHR9XG5cdFx0Ly8gRXhwbGljaXRseSB3cmFwIGluIHpvbmVcblx0XHRsZXQgem9uZWRDYWxsYmFjayA9ICguLi5hcmdzKSA9PiB7XG5cdFx0XHR0aGlzLnpvbmUucnVuKCgpID0+IHtcblx0XHRcdFx0Y2FsbGJhY2suYXBwbHkodW5kZWZpbmVkLCBhcmdzKTtcblx0XHRcdH0pO1xuXHRcdH07XG5cblx0XHRyZW5kZXJFbGVtZW50Lm9uKGV2ZW50TmFtZSwgem9uZWRDYWxsYmFjayk7XG5cdFx0aWYgKGV2ZW50TmFtZSA9PT0gVmlldy5sb2FkZWRFdmVudCAmJiByZW5kZXJFbGVtZW50LmlzTG9hZGVkKSB7XG5cdFx0XHRjb25zdCBub3RpZnlEYXRhID0geyBldmVudE5hbWU6IFZpZXcubG9hZGVkRXZlbnQsIG9iamVjdDogcmVuZGVyRWxlbWVudCB9O1xuXHRcdFx0em9uZWRDYWxsYmFjayhub3RpZnlEYXRhKTtcblx0XHR9XG5cdFx0cmV0dXJuICgpID0+IHJlbmRlckVsZW1lbnQub2ZmKGV2ZW50TmFtZSwgem9uZWRDYWxsYmFjayk7XG5cdH1cbn1cbiJdfQ==