import { View } from '@nativescript/core';
import { createKeyframeAnimation } from './utils';
import { NativeScriptDebug } from '../trace';
export class NativeScriptAnimationPlayer {
    constructor(target, keyframes, duration, delay, easing) {
        this.target = target;
        this.duration = duration;
        this.delay = delay;
        this.parentPlayer = null;
        this._startSubscriptions = [];
        this._doneSubscriptions = [];
        this._finished = false;
        this._started = false;
        this.initKeyframeAnimation(keyframes, duration, delay, easing);
    }
    get totalTime() {
        return this.delay + this.duration;
    }
    init() { }
    hasStarted() {
        return this._started;
    }
    onStart(fn) {
        this._startSubscriptions.push(fn);
    }
    onDone(fn) {
        this._doneSubscriptions.push(fn);
    }
    onDestroy(fn) {
        this._doneSubscriptions.push(fn);
    }
    play() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.animationsLog(`NativeScriptAnimationPlayer.play`);
        }
        if (!this.animation) {
            return;
        }
        if (!this._started) {
            this._started = true;
            this._startSubscriptions.forEach((fn) => fn());
            this._startSubscriptions = [];
        }
        // When this issue https://github.com/NativeScript/NativeScript/issues/7984 is fixes in @nativescript/core
        // we can change this fix and apply the one that is recommended in that issue.
        if (this.target.isLoaded) {
            this.playAnimation();
        }
        else {
            this.target.on(View.loadedEvent, this.onTargetLoaded.bind(this));
        }
    }
    onTargetLoaded(args) {
        this.target.off(View.loadedEvent, this.onTargetLoaded);
        this.playAnimation();
    }
    playAnimation() {
        this.animation
            .play(this.target)
            .then(() => this.onFinish())
            .catch((_e) => { });
    }
    pause() { }
    finish() {
        this.onFinish();
    }
    reset() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.animationsLog(`NativeScriptAnimationPlayer.reset`);
        }
        if (this.animation && this.animation.isPlaying) {
            this.animation.cancel();
        }
    }
    restart() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.animationsLog(`NativeScriptAnimationPlayer.restart`);
        }
        this.reset();
        this.play();
    }
    destroy() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.animationsLog(`NativeScriptAnimationPlayer.destroy`);
        }
        this.onFinish();
    }
    setPosition(_p) {
        throw new Error('AnimationPlayer.setPosition method is not supported!');
    }
    getPosition() {
        return 0;
    }
    initKeyframeAnimation(keyframes, duration, delay, easing) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.animationsLog(`NativeScriptAnimationPlayer.initKeyframeAnimation`);
        }
        this.animation = createKeyframeAnimation(keyframes, duration, delay, easing);
    }
    onFinish() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.animationsLog(`NativeScriptAnimationPlayer.onFinish`);
        }
        if (this._finished) {
            return;
        }
        this._finished = true;
        this._started = false;
        this._doneSubscriptions.forEach((fn) => fn());
        this._doneSubscriptions = [];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbWF0aW9uLXBsYXllci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2FuaW1hdGlvbnMvYW5pbWF0aW9uLXBsYXllci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsSUFBSSxFQUFnQyxNQUFNLG9CQUFvQixDQUFDO0FBRXhFLE9BQU8sRUFBWSx1QkFBdUIsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUU1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFN0MsTUFBTSxPQUFPLDJCQUEyQjtJQVN2QyxZQUFvQixNQUFjLEVBQUUsU0FBcUIsRUFBVSxRQUFnQixFQUFVLEtBQWEsRUFBRSxNQUFjO1FBQXRHLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBaUMsYUFBUSxHQUFSLFFBQVEsQ0FBUTtRQUFVLFVBQUssR0FBTCxLQUFLLENBQVE7UUFSbkcsaUJBQVksR0FBb0IsSUFBSSxDQUFDO1FBRXBDLHdCQUFtQixHQUFlLEVBQUUsQ0FBQztRQUNyQyx1QkFBa0IsR0FBZSxFQUFFLENBQUM7UUFDcEMsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBSXhCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRUQsSUFBSSxTQUFTO1FBQ1osT0FBTyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDbkMsQ0FBQztJQUVELElBQUksS0FBVSxDQUFDO0lBRWYsVUFBVTtRQUNULE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN0QixDQUFDO0lBRUQsT0FBTyxDQUFDLEVBQVk7UUFDbkIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0QsTUFBTSxDQUFDLEVBQVk7UUFDbEIs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YSxFQUFFLE1BQWM7UUFDbkcsSUFBSSxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsRUFBRTtZQUNyQyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsbURBQW1ELENBQUMsQ0FBQztTQUNyRjtRQUVELElBQUksQ0FBQyxTQUFTLEdBQUcsdUJBQXVCLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLFFBQVE7UUFDZixJQUFJLGlCQUFpQixDQUFDLFlBQVksRUFBRSxFQUFFO1lBQ3JDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1NBQ3hFO1FBRUQsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25CLE9BQU87U0FDUDtRQUVELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztJQUM5QixDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBbmltYXRpb25QbGF5ZXIgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IFZpZXcsIEV2ZW50RGF0YSwgS2V5ZnJhbWVBbmltYXRpb24gfSBmcm9tICdAbmF0aXZlc2NyaXB0L2NvcmUnO1xuXG5pbXBvcnQgeyBLZXlmcmFtZSwgY3JlYXRlS2V5ZnJhbWVBbmltYXRpb24gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IE5nVmlldyB9IGZyb20gJy4uL2VsZW1lbnQtcmVnaXN0cnknO1xuaW1wb3J0IHsgTmF0aXZlU2NyaXB0RGVidWcgfSBmcm9tICcuLi90cmFjZSc7XG5cbmV4cG9ydCBjbGFzcyBOYXRpdmVTY3JpcHRBbmltYXRpb25QbGF5ZXIgaW1wbGVtZW50cyBBbmltYXRpb25QbGF5ZXIge1xuXHRwdWJsaWMgcGFyZW50UGxheWVyOiBBbmltYXRpb25QbGF5ZXIgPSBudWxsO1xuXG5cdHByaXZhdGUgX3N0YXJ0U3Vic2NyaXB0aW9uczogRnVuY3Rpb25bXSA9IFtdO1xuXHRwcml2YXRlIF9kb25lU3Vic2NyaXB0aW9uczogRnVuY3Rpb25bXSA9IFtdO1xuXHRwcml2YXRlIF9maW5pc2hlZCA9IGZhbHNlO1xuXHRwcml2YXRlIF9zdGFydGVkID0gZmFsc2U7XG5cdHByaXZhdGUgYW5pbWF0aW9uOiBLZXlmcmFtZUFuaW1hdGlvbjtcblxuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIHRhcmdldDogTmdWaWV3LCBrZXlmcmFtZXM6IEtleWZyYW1lW10sIHByaXZhdGUgZHVyYXRpb246IG51bWJlciwgcHJpdmF0ZSBkZWxheTogbnVtYmVyLCBlYXNpbmc6IHN0cmluZykge1xuXHRcdHRoaXMuaW5pdEtleWZyYW1lQW5pbWF0aW9uKGtleWZyYW1lcywgZHVyYXRpb24sIGRlbGF5LCBlYXNpbmcpO1xuXHR9XG5cblx0Z2V0IHRvdGFsVGltZSgpOiBudW1iZXIge1xuXHRcdHJldHVybiB0aGlzLmRlbGF5ICsgdGhpcy5kdXJhdGlvbjtcblx0fVxuXG5cdGluaXQoKTogdm9pZCB7fVxuXG5cdGhhc1N0YXJ0ZWQoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuX3N0YXJ0ZWQ7XG5cdH1cblxuXHRvblN0YXJ0KGZuOiBGdW5jdGlvbik6IHZvaWQge1xuXHRcdHRoaXMuX3N0YXJ0U3Vic2NyaXB0aW9ucy5wdXNoKGZuKTtcblx0fVxuXHRvbkRvbmUoZm46IEZ1bmN0aW9uKTogdm9pZCB7XG5cdFx0dGhpcy5fZG9uZVN1YnNjcmlwdGlvbnMucHVzaChmbik7XG5cdH1cblx0b25EZXN0cm95KGZuOiBGdW5jdGlvbik6IHZvaWQge1xuXHRcdHRoaXMuX2RvbmVTdWJzY3JpcHRpb25zLnB1c2goZm4pO1xuXHR9XG5cblx0cGxheSgpOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLmFuaW1hdGlvbnNMb2coYE5hdGl2ZVNjcmlwdEFuaW1hdGlvblBsYXllci5wbGF5YCk7XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLmFuaW1hdGlvbikge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fc3RhcnRlZCkge1xuXHRcdFx0dGhpcy5fc3RhcnRlZCA9IHRydWU7XG5cdFx0XHR0aGlzLl9zdGFydFN1YnNjcmlwdGlvbnMuZm9yRWFjaCgoZm4pID0+IGZuKCkpO1xuXHRcdFx0dGhpcy5fc3RhcnRTdWJzY3JpcHRpb25zID0gW107XG5cdFx0fVxuXG5cdFx0Ly8gV2hlbiB0aGlzIGlzc3VlIGh0dHBzOi8vZ2l0aHViLmNvbS9OYXRpdmVTY3JpcHQvTmF0aXZlU2NyaXB0L2lzc3Vlcy83OTg0IGlzIGZpeGVzIGluIEBuYXRpdmVzY3JpcHQvY29yZVxuXHRcdC8vIHdlIGNhbiBjaGFuZ2UgdGhpcyBmaXggYW5kIGFwcGx5IHRoZSBvbmUgdGhhdCBpcyByZWNvbW1lbmRlZCBpbiB0aGF0IGlzc3VlLlxuXHRcdGlmICh0aGlzLnRhcmdldC5pc0xvYWRlZCkge1xuXHRcdFx0dGhpcy5wbGF5QW5pbWF0aW9uKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMudGFyZ2V0Lm9uKFZpZXcubG9hZGVkRXZlbnQsIHRoaXMub25UYXJnZXRMb2FkZWQuYmluZCh0aGlzKSk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBvblRhcmdldExvYWRlZChhcmdzOiBFdmVudERhdGEpIHtcblx0XHR0aGlzLnRhcmdldC5vZmYoVmlldy5sb2FkZWRFdmVudCwgdGhpcy5vblRhcmdldExvYWRlZCk7XG5cdFx0dGhpcy5wbGF5QW5pbWF0aW9uKCk7XG5cdH1cblxuXHRwcml2YXRlIHBsYXlBbmltYXRpb24oKSB7XG5cdFx0dGhpcy5hbmltYXRpb25cblx0XHRcdC5wbGF5KHRoaXMudGFyZ2V0KVxuXHRcdFx0LnRoZW4oKCkgPT4gdGhpcy5vbkZpbmlzaCgpKVxuXHRcdFx0LmNhdGNoKChfZSkgPT4ge30pO1xuXHR9XG5cblx0cGF1c2UoKTogdm9pZCB7fVxuXG5cdGZpbmlzaCgpOiB2b2lkIHtcblx0XHR0aGlzLm9uRmluaXNoKCk7XG5cdH1cblxuXHRyZXNldCgpOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLmFuaW1hdGlvbnNMb2coYE5hdGl2ZVNjcmlwdEFuaW1hdGlvblBsYXllci5yZXNldGApO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLmFuaW1hdGlvbiAmJiB0aGlzLmFuaW1hdGlvbi5pc1BsYXlpbmcpIHtcblx0XHRcdHRoaXMuYW5pbWF0aW9uLmNhbmNlbCgpO1xuXHRcdH1cblx0fVxuXG5cdHJlc3RhcnQoKTogdm9pZCB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5hbmltYXRpb25zTG9nKGBOYXRpdmVTY3JpcHRBbmltYXRpb25QbGF5ZXIucmVzdGFydGApO1xuXHRcdH1cblxuXHRcdHRoaXMucmVzZXQoKTtcblx0XHR0aGlzLnBsYXkoKTtcblx0fVxuXG5cdGRlc3Ryb3koKTogdm9pZCB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5hbmltYXRpb25zTG9nKGBOYXRpdmVTY3JpcHRBbmltYXRpb25QbGF5ZXIuZGVzdHJveWApO1xuXHRcdH1cblx0XHR0aGlzLm9uRmluaXNoKCk7XG5cdH1cblxuXHRzZXRQb3NpdGlvbihfcDogYW55KTogdm9pZCB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdBbmltYXRpb25QbGF5ZXIuc2V0UG9zaXRpb24gbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQhJyk7XG5cdH1cblxuXHRnZXRQb3NpdGlvbigpOiBudW1iZXIge1xuXHRcdHJldHVybiAwO1xuXHR9XG5cblx0cHJpdmF0ZSBpbml0S2V5ZnJhbWVBbmltYXRpb24oa2V5ZnJhbWVzOiBLZXlmcmFtZVtdLCBkdXJhdGlvbjogbnVtYmVyLCBkZWxheTogbnVtYmVyLCBlYXNpbmc6IHN0cmluZykge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcuYW5pbWF0aW9uc0xvZyhgTmF0aXZlU2NyaXB0QW5pbWF0aW9uUGxheWVyLmluaXRLZXlmcmFtZUFuaW1hdGlvbmApO1xuXHRcdH1cblxuXHRcdHRoaXMuYW5pbWF0aW9uID0gY3JlYXRlS2V5ZnJhbWVBbmltYXRpb24oa2V5ZnJhbWVzLCBkdXJhdGlvbiwgZGVsYXksIGVhc2luZyk7XG5cdH1cblxuXHRwcml2YXRlIG9uRmluaXNoKCkge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcuYW5pbWF0aW9uc0xvZyhgTmF0aXZlU2NyaXB0QW5pbWF0aW9uUGxheWVyLm9uRmluaXNoYCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuX2ZpbmlzaGVkKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0dGhpcy5fZmluaXNoZWQgPSB0cnVlO1xuXHRcdHRoaXMuX3N0YXJ0ZWQgPSBmYWxzZTtcblx0XHR0aGlzLl9kb25lU3Vic2NyaXB0aW9ucy5mb3JFYWNoKChmbikgPT4gZm4oKSk7XG5cdFx0dGhpcy5fZG9uZVN1YnNjcmlwdGlvbnMgPSBbXTtcblx0fVxufVxuIl19