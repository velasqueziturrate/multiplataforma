import { Directive, Component, ElementRef, Optional } from '@angular/core';
import { ActionBar, ActionItem, NavigationButton, Page } from '@nativescript/core';
import { isBlank } from '../lang-facade';
import { isInvisibleNode, isView, registerElement } from '../element-registry';
export function isActionItem(view) {
    return view instanceof ActionItem;
}
export function isNavigationButton(view) {
    return view instanceof NavigationButton;
}
const ɵ0 = (parent, child, next) => {
    if (isInvisibleNode(child)) {
        return;
    }
    else if (isNavigationButton(child)) {
        parent.navigationButton = child;
        child.parentNode = parent;
    }
    else if (isActionItem(child)) {
        addActionItem(parent, child, next);
        child.parentNode = parent;
    }
    else if (isView(child)) {
        parent.titleView = child;
    }
}, ɵ1 = (parent, child) => {
    if (isInvisibleNode(child)) {
        return;
    }
    else if (isNavigationButton(child)) {
        if (parent.navigationButton === child) {
            parent.navigationButton = null;
        }
        child.parentNode = null;
    }
    else if (isActionItem(child)) {
        parent.actionItems.removeItem(child);
        child.parentNode = null;
    }
    else if (isView(child) && parent.titleView && parent.titleView === child) {
        parent.titleView = null;
    }
};
const actionBarMeta = {
    skipAddToDom: true,
    insertChild: ɵ0,
    removeChild: ɵ1,
};
const addActionItem = (bar, item, next) => {
    if (next) {
        insertActionItemBefore(bar, item, next);
    }
    else {
        appendActionItem(bar, item);
    }
};
const ɵ2 = addActionItem;
const insertActionItemBefore = (bar, item, next) => {
    const actionItems = bar.actionItems;
    const actionItemsCollection = actionItems.getItems();
    const indexToInsert = actionItemsCollection.indexOf(next);
    actionItemsCollection.splice(indexToInsert, 0, item);
    actionItems.setItems(actionItemsCollection);
};
const ɵ3 = insertActionItemBefore;
const appendActionItem = (bar, item) => {
    bar.actionItems.addItem(item);
};
const ɵ4 = appendActionItem;
registerElement('ActionBar', () => ActionBar, actionBarMeta);
registerElement('ActionItem', () => ActionItem);
registerElement('NavigationButton', () => NavigationButton);
export class ActionBarComponent {
    constructor(element, page) {
        this.element = element;
        this.page = page;
        if (!this.page) {
            throw new Error('Inside ActionBarComponent but no Page found in DI.');
        }
        if (isBlank(this.page.actionBarHidden)) {
            this.page.actionBarHidden = false;
        }
        this.page.actionBar = this.element.nativeElement;
        this.page.actionBar.update();
    }
}
ActionBarComponent.decorators = [
    { type: Component, args: [{
                selector: 'ActionBar',
                template: '<ng-content></ng-content>'
            },] }
];
ActionBarComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Page }
];
export class ActionBarScope {
    // tslint:disable-line:component-class-suffix
    constructor(page) {
        this.page = page;
        if (!this.page) {
            throw new Error('Inside ActionBarScope but no Page found in DI.');
        }
    }
    onNavButtonInit(navBtn) {
        this.page.actionBar.navigationButton = navBtn.element.nativeElement;
    }
    onNavButtonDestroy(navBtn) {
        const nav = navBtn.element.nativeElement;
        if (nav && this.page.actionBar.navigationButton === nav) {
            this.page.actionBar.navigationButton = null;
        }
    }
    onActionInit(item) {
        this.page.actionBar.actionItems.addItem(item.element.nativeElement);
    }
    onActionDestroy(item) {
        if (item.element.nativeElement.actionBar) {
            this.page.actionBar.actionItems.removeItem(item.element.nativeElement);
        }
    }
}
ActionBarScope.decorators = [
    { type: Component, args: [{
                selector: 'ActionBarExtension',
                template: ''
            },] }
];
ActionBarScope.ctorParameters = () => [
    { type: Page }
];
export class ActionItemDirective {
    constructor(element, ownerScope) {
        this.element = element;
        this.ownerScope = ownerScope;
        if (this.ownerScope) {
            this.ownerScope.onActionInit(this);
        }
    }
    ngOnDestroy() {
        if (this.ownerScope) {
            this.ownerScope.onActionDestroy(this);
        }
    }
}
ActionItemDirective.decorators = [
    { type: Directive, args: [{
                selector: 'ActionItem',
            },] }
];
ActionItemDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: ActionBarScope, decorators: [{ type: Optional }] }
];
export class NavigationButtonDirective {
    constructor(element, ownerScope) {
        this.element = element;
        this.ownerScope = ownerScope;
        if (this.ownerScope) {
            this.ownerScope.onNavButtonInit(this);
        }
    }
    ngOnDestroy() {
        if (this.ownerScope) {
            this.ownerScope.onNavButtonDestroy(this);
        }
    }
}
NavigationButtonDirective.decorators = [
    { type: Directive, args: [{
                selector: 'NavigationButton',
            },] }
];
NavigationButtonDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: ActionBarScope, decorators: [{ type: Optional }] }
];
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uLWJhci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2RpcmVjdGl2ZXMvYWN0aW9uLWJhci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ3RGLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFlLGdCQUFnQixFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRWhHLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6QyxPQUFPLEVBQXlDLGVBQWUsRUFBRSxNQUFNLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdEgsTUFBTSxVQUFVLFlBQVksQ0FBQyxJQUFTO0lBQ3JDLE9BQU8sSUFBSSxZQUFZLFVBQVUsQ0FBQztBQUNuQyxDQUFDO0FBRUQsTUFBTSxVQUFVLGtCQUFrQixDQUFDLElBQVM7SUFDM0MsT0FBTyxJQUFJLFlBQVksZ0JBQWdCLENBQUM7QUFDekMsQ0FBQztXQU1hLENBQUMsTUFBbUIsRUFBRSxLQUFhLEVBQUUsSUFBUyxFQUFFLEVBQUU7SUFDOUQsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDM0IsT0FBTztLQUNQO1NBQU0sSUFBSSxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUNyQyxNQUFNLENBQUMsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO1FBQ2hDLEtBQUssQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDO0tBQzFCO1NBQU0sSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDL0IsYUFBYSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDbkMsS0FBSyxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7S0FDMUI7U0FBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUN6QixNQUFNLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztLQUN6QjtBQUNGLENBQUMsT0FDWSxDQUFDLE1BQW1CLEVBQUUsS0FBYSxFQUFFLEVBQUU7SUFDbkQsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDM0IsT0FBTztLQUNQO1NBQU0sSUFBSSxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUNyQyxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsS0FBSyxLQUFLLEVBQUU7WUFDdEMsTUFBTSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQztTQUMvQjtRQUVELEtBQUssQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO0tBQ3hCO1NBQU0sSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDL0IsTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckMsS0FBSyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7S0FDeEI7U0FBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxNQUFNLENBQUMsU0FBUyxJQUFJLE1BQU0sQ0FBQyxTQUFTLEtBQUssS0FBSyxFQUFFO1FBQzNFLE1BQU0sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO0tBQ3hCO0FBQ0YsQ0FBQztBQTlCRixNQUFNLGFBQWEsR0FBa0I7SUFDcEMsWUFBWSxFQUFFLElBQUk7SUFDbEIsV0FBVyxJQVlWO0lBQ0QsV0FBVyxJQWVWO0NBQ0QsQ0FBQztBQUVGLE1BQU0sYUFBYSxHQUFHLENBQUMsR0FBZ0IsRUFBRSxJQUFnQixFQUFFLElBQWdCLEVBQUUsRUFBRTtJQUM5RSxJQUFJLElBQUksRUFBRTtRQUNULHNCQUFzQixDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDeEM7U0FBTTtRQUNOLGdCQUFnQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztLQUM1QjtBQUNGLENBQUMsQ0FBQzs7QUFFRixNQUFNLHNCQUFzQixHQUFHLENBQUMsR0FBZ0IsRUFBRSxJQUFnQixFQUFFLElBQWdCLEVBQUUsRUFBRTtJQUN2RixNQUFNLFdBQVcsR0FBZ0IsR0FBRyxDQUFDLFdBQVcsQ0FBQztJQUNqRCxNQUFNLHFCQUFxQixHQUFpQixXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7SUFFbkUsTUFBTSxhQUFhLEdBQUcscUJBQXFCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzFELHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRS9DLFdBQVksQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUNwRCxDQUFDLENBQUM7O0FBRUYsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLEdBQWdCLEVBQUUsSUFBZ0IsRUFBRSxFQUFFO0lBQy9ELEdBQUcsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQy9CLENBQUMsQ0FBQzs7QUFFRixlQUFlLENBQUMsV0FBVyxFQUFFLEdBQUcsRUFBRSxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUM3RCxlQUFlLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRSxDQUFNLFVBQVUsQ0FBQyxDQUFDO0FBQ3JELGVBQWUsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUUsQ0FBTSxnQkFBZ0IsQ0FBQyxDQUFDO0FBTWpFLE1BQU0sT0FBTyxrQkFBa0I7SUFDOUIsWUFBbUIsT0FBbUIsRUFBVSxJQUFVO1FBQXZDLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFNO1FBQ3pELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2YsTUFBTSxJQUFJLEtBQUssQ0FBQyxvREFBb0QsQ0FBQyxDQUFDO1NBQ3RFO1FBRUQsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsRUFBRTtZQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7U0FDbEM7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQztRQUNqRCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUM5QixDQUFDOzs7WUFmRCxTQUFTLFNBQUM7Z0JBQ1YsUUFBUSxFQUFFLFdBQVc7Z0JBQ3JCLFFBQVEsRUFBRSwyQkFBMkI7YUFDckM7OztZQTlFOEIsVUFBVTtZQUNzQixJQUFJOztBQWdHbkUsTUFBTSxPQUFPLGNBQWM7SUFDMUIsNkNBQTZDO0lBQzdDLFlBQW9CLElBQVU7UUFBVixTQUFJLEdBQUosSUFBSSxDQUFNO1FBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2YsTUFBTSxJQUFJLEtBQUssQ0FBQyxnREFBZ0QsQ0FBQyxDQUFDO1NBQ2xFO0lBQ0YsQ0FBQztJQUVNLGVBQWUsQ0FBQyxNQUFpQztRQUN2RCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQztJQUNyRSxDQUFDO0lBRU0sa0JBQWtCLENBQUMsTUFBaUM7UUFDMUQsTUFBTSxHQUFHLEdBQXFCLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDO1FBQzNELElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixLQUFLLEdBQUcsRUFBRTtZQUN4RCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7U0FDNUM7SUFDRixDQUFDO0lBRU0sWUFBWSxDQUFDLElBQXlCO1FBQzVDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRU0sZUFBZSxDQUFDLElBQXlCO1FBQy9DLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFO1lBQ3pDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUN2RTtJQUNGLENBQUM7OztZQS9CRCxTQUFTLFNBQUM7Z0JBQ1YsUUFBUSxFQUFFLG9CQUFvQjtnQkFDOUIsUUFBUSxFQUFFLEVBQUU7YUFDWjs7O1lBL0Y4RCxJQUFJOztBQWlJbkUsTUFBTSxPQUFPLG1CQUFtQjtJQUMvQixZQUFtQixPQUFtQixFQUFzQixVQUEwQjtRQUFuRSxZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQXNCLGVBQVUsR0FBVixVQUFVLENBQWdCO1FBQ3JGLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNwQixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNuQztJQUNGLENBQUM7SUFFRCxXQUFXO1FBQ1YsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ3BCLElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3RDO0lBQ0YsQ0FBQzs7O1lBZEQsU0FBUyxTQUFDO2dCQUNWLFFBQVEsRUFBRSxZQUFZO2FBQ3RCOzs7WUFqSThCLFVBQVU7WUFtSWdDLGNBQWMsdUJBQTdDLFFBQVE7O0FBZ0JsRCxNQUFNLE9BQU8seUJBQXlCO0lBQ3JDLFlBQW1CLE9BQW1CLEVBQXNCLFVBQTBCO1FBQW5FLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFBc0IsZUFBVSxHQUFWLFVBQVUsQ0FBZ0I7UUFDckYsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ3BCLElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3RDO0lBQ0YsQ0FBQztJQUVELFdBQVc7UUFDVixJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDcEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN6QztJQUNGLENBQUM7OztZQWRELFNBQVMsU0FBQztnQkFDVixRQUFRLEVBQUUsa0JBQWtCO2FBQzVCOzs7WUFsSjhCLFVBQVU7WUFvSmdDLGNBQWMsdUJBQTdDLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgT3B0aW9uYWwsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9uQmFyLCBBY3Rpb25JdGVtLCBBY3Rpb25JdGVtcywgTmF2aWdhdGlvbkJ1dHRvbiwgUGFnZSB9IGZyb20gJ0BuYXRpdmVzY3JpcHQvY29yZSc7XG5cbmltcG9ydCB7IGlzQmxhbmsgfSBmcm9tICcuLi9sYW5nLWZhY2FkZSc7XG5pbXBvcnQgeyBOZ1ZpZXcsIFZpZXdDbGFzc01ldGEsIFZpZXdFeHRlbnNpb25zLCBpc0ludmlzaWJsZU5vZGUsIGlzVmlldywgcmVnaXN0ZXJFbGVtZW50IH0gZnJvbSAnLi4vZWxlbWVudC1yZWdpc3RyeSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0FjdGlvbkl0ZW0odmlldzogYW55KTogdmlldyBpcyBBY3Rpb25JdGVtIHtcblx0cmV0dXJuIHZpZXcgaW5zdGFuY2VvZiBBY3Rpb25JdGVtO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNOYXZpZ2F0aW9uQnV0dG9uKHZpZXc6IGFueSk6IHZpZXcgaXMgTmF2aWdhdGlvbkJ1dHRvbiB7XG5cdHJldHVybiB2aWV3IGluc3RhbmNlb2YgTmF2aWdhdGlvbkJ1dHRvbjtcbn1cblxudHlwZSBOZ0FjdGlvbkJhciA9IEFjdGlvbkJhciAmIFZpZXdFeHRlbnNpb25zO1xuXG5jb25zdCBhY3Rpb25CYXJNZXRhOiBWaWV3Q2xhc3NNZXRhID0ge1xuXHRza2lwQWRkVG9Eb206IHRydWUsXG5cdGluc2VydENoaWxkOiAocGFyZW50OiBOZ0FjdGlvbkJhciwgY2hpbGQ6IE5nVmlldywgbmV4dDogYW55KSA9PiB7XG5cdFx0aWYgKGlzSW52aXNpYmxlTm9kZShjaGlsZCkpIHtcblx0XHRcdHJldHVybjtcblx0XHR9IGVsc2UgaWYgKGlzTmF2aWdhdGlvbkJ1dHRvbihjaGlsZCkpIHtcblx0XHRcdHBhcmVudC5uYXZpZ2F0aW9uQnV0dG9uID0gY2hpbGQ7XG5cdFx0XHRjaGlsZC5wYXJlbnROb2RlID0gcGFyZW50O1xuXHRcdH0gZWxzZSBpZiAoaXNBY3Rpb25JdGVtKGNoaWxkKSkge1xuXHRcdFx0YWRkQWN0aW9uSXRlbShwYXJlbnQsIGNoaWxkLCBuZXh0KTtcblx0XHRcdGNoaWxkLnBhcmVudE5vZGUgPSBwYXJlbnQ7XG5cdFx0fSBlbHNlIGlmIChpc1ZpZXcoY2hpbGQpKSB7XG5cdFx0XHRwYXJlbnQudGl0bGVWaWV3ID0gY2hpbGQ7XG5cdFx0fVxuXHR9LFxuXHRyZW1vdmVDaGlsZDogKHBhcmVudDogTmdBY3Rpb25CYXIsIGNoaWxkOiBOZ1ZpZXcpID0+IHtcblx0XHRpZiAoaXNJbnZpc2libGVOb2RlKGNoaWxkKSkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH0gZWxzZSBpZiAoaXNOYXZpZ2F0aW9uQnV0dG9uKGNoaWxkKSkge1xuXHRcdFx0aWYgKHBhcmVudC5uYXZpZ2F0aW9uQnV0dG9uID09PSBjaGlsZCkge1xuXHRcdFx0XHRwYXJlbnQubmF2aWdhdGlvbkJ1dHRvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGNoaWxkLnBhcmVudE5vZGUgPSBudWxsO1xuXHRcdH0gZWxzZSBpZiAoaXNBY3Rpb25JdGVtKGNoaWxkKSkge1xuXHRcdFx0cGFyZW50LmFjdGlvbkl0ZW1zLnJlbW92ZUl0ZW0oY2hpbGQpO1xuXHRcdFx0Y2hpbGQucGFyZW50Tm9kZSA9IG51bGw7XG5cdFx0fSBlbHNlIGlmIChpc1ZpZXcoY2hpbGQpICYmIHBhcmVudC50aXRsZVZpZXcgJiYgcGFyZW50LnRpdGxlVmlldyA9PT0gY2hpbGQpIHtcblx0XHRcdHBhcmVudC50aXRsZVZpZXcgPSBudWxsO1xuXHRcdH1cblx0fSxcbn07XG5cbmNvbnN0IGFkZEFjdGlvbkl0ZW0gPSAoYmFyOiBOZ0FjdGlvbkJhciwgaXRlbTogQWN0aW9uSXRlbSwgbmV4dDogQWN0aW9uSXRlbSkgPT4ge1xuXHRpZiAobmV4dCkge1xuXHRcdGluc2VydEFjdGlvbkl0ZW1CZWZvcmUoYmFyLCBpdGVtLCBuZXh0KTtcblx0fSBlbHNlIHtcblx0XHRhcHBlbmRBY3Rpb25JdGVtKGJhciwgaXRlbSk7XG5cdH1cbn07XG5cbmNvbnN0IGluc2VydEFjdGlvbkl0ZW1CZWZvcmUgPSAoYmFyOiBOZ0FjdGlvbkJhciwgaXRlbTogQWN0aW9uSXRlbSwgbmV4dDogQWN0aW9uSXRlbSkgPT4ge1xuXHRjb25zdCBhY3Rpb25JdGVtczogQWN0aW9uSXRlbXMgPSBiYXIuYWN0aW9uSXRlbXM7XG5cdGNvbnN0IGFjdGlvbkl0ZW1zQ29sbGVjdGlvbjogQWN0aW9uSXRlbVtdID0gYWN0aW9uSXRlbXMuZ2V0SXRlbXMoKTtcblxuXHRjb25zdCBpbmRleFRvSW5zZXJ0ID0gYWN0aW9uSXRlbXNDb2xsZWN0aW9uLmluZGV4T2YobmV4dCk7XG5cdGFjdGlvbkl0ZW1zQ29sbGVjdGlvbi5zcGxpY2UoaW5kZXhUb0luc2VydCwgMCwgaXRlbSk7XG5cblx0KDxhbnk+YWN0aW9uSXRlbXMpLnNldEl0ZW1zKGFjdGlvbkl0ZW1zQ29sbGVjdGlvbik7XG59O1xuXG5jb25zdCBhcHBlbmRBY3Rpb25JdGVtID0gKGJhcjogTmdBY3Rpb25CYXIsIGl0ZW06IEFjdGlvbkl0ZW0pID0+IHtcblx0YmFyLmFjdGlvbkl0ZW1zLmFkZEl0ZW0oaXRlbSk7XG59O1xuXG5yZWdpc3RlckVsZW1lbnQoJ0FjdGlvbkJhcicsICgpID0+IEFjdGlvbkJhciwgYWN0aW9uQmFyTWV0YSk7XG5yZWdpc3RlckVsZW1lbnQoJ0FjdGlvbkl0ZW0nLCAoKSA9PiA8YW55PkFjdGlvbkl0ZW0pO1xucmVnaXN0ZXJFbGVtZW50KCdOYXZpZ2F0aW9uQnV0dG9uJywgKCkgPT4gPGFueT5OYXZpZ2F0aW9uQnV0dG9uKTtcblxuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiAnQWN0aW9uQmFyJyxcblx0dGVtcGxhdGU6ICc8bmctY29udGVudD48L25nLWNvbnRlbnQ+Jyxcbn0pXG5leHBvcnQgY2xhc3MgQWN0aW9uQmFyQ29tcG9uZW50IHtcblx0Y29uc3RydWN0b3IocHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIHByaXZhdGUgcGFnZTogUGFnZSkge1xuXHRcdGlmICghdGhpcy5wYWdlKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0luc2lkZSBBY3Rpb25CYXJDb21wb25lbnQgYnV0IG5vIFBhZ2UgZm91bmQgaW4gREkuJyk7XG5cdFx0fVxuXG5cdFx0aWYgKGlzQmxhbmsodGhpcy5wYWdlLmFjdGlvbkJhckhpZGRlbikpIHtcblx0XHRcdHRoaXMucGFnZS5hY3Rpb25CYXJIaWRkZW4gPSBmYWxzZTtcblx0XHR9XG5cdFx0dGhpcy5wYWdlLmFjdGlvbkJhciA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuXHRcdHRoaXMucGFnZS5hY3Rpb25CYXIudXBkYXRlKCk7XG5cdH1cbn1cblxuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiAnQWN0aW9uQmFyRXh0ZW5zaW9uJyxcblx0dGVtcGxhdGU6ICcnLFxufSlcbmV4cG9ydCBjbGFzcyBBY3Rpb25CYXJTY29wZSB7XG5cdC8vIHRzbGludDpkaXNhYmxlLWxpbmU6Y29tcG9uZW50LWNsYXNzLXN1ZmZpeFxuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIHBhZ2U6IFBhZ2UpIHtcblx0XHRpZiAoIXRoaXMucGFnZSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdJbnNpZGUgQWN0aW9uQmFyU2NvcGUgYnV0IG5vIFBhZ2UgZm91bmQgaW4gREkuJyk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIG9uTmF2QnV0dG9uSW5pdChuYXZCdG46IE5hdmlnYXRpb25CdXR0b25EaXJlY3RpdmUpIHtcblx0XHR0aGlzLnBhZ2UuYWN0aW9uQmFyLm5hdmlnYXRpb25CdXR0b24gPSBuYXZCdG4uZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuXHR9XG5cblx0cHVibGljIG9uTmF2QnV0dG9uRGVzdHJveShuYXZCdG46IE5hdmlnYXRpb25CdXR0b25EaXJlY3RpdmUpIHtcblx0XHRjb25zdCBuYXYgPSA8TmF2aWdhdGlvbkJ1dHRvbj5uYXZCdG4uZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuXHRcdGlmIChuYXYgJiYgdGhpcy5wYWdlLmFjdGlvbkJhci5uYXZpZ2F0aW9uQnV0dG9uID09PSBuYXYpIHtcblx0XHRcdHRoaXMucGFnZS5hY3Rpb25CYXIubmF2aWdhdGlvbkJ1dHRvbiA9IG51bGw7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIG9uQWN0aW9uSW5pdChpdGVtOiBBY3Rpb25JdGVtRGlyZWN0aXZlKSB7XG5cdFx0dGhpcy5wYWdlLmFjdGlvbkJhci5hY3Rpb25JdGVtcy5hZGRJdGVtKGl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcblx0fVxuXG5cdHB1YmxpYyBvbkFjdGlvbkRlc3Ryb3koaXRlbTogQWN0aW9uSXRlbURpcmVjdGl2ZSkge1xuXHRcdGlmIChpdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudC5hY3Rpb25CYXIpIHtcblx0XHRcdHRoaXMucGFnZS5hY3Rpb25CYXIuYWN0aW9uSXRlbXMucmVtb3ZlSXRlbShpdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG5cdFx0fVxuXHR9XG59XG5cbkBEaXJlY3RpdmUoe1xuXHRzZWxlY3RvcjogJ0FjdGlvbkl0ZW0nLCAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOmRpcmVjdGl2ZS1zZWxlY3RvclxufSlcbmV4cG9ydCBjbGFzcyBBY3Rpb25JdGVtRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95IHtcblx0Y29uc3RydWN0b3IocHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIEBPcHRpb25hbCgpIHByaXZhdGUgb3duZXJTY29wZTogQWN0aW9uQmFyU2NvcGUpIHtcblx0XHRpZiAodGhpcy5vd25lclNjb3BlKSB7XG5cdFx0XHR0aGlzLm93bmVyU2NvcGUub25BY3Rpb25Jbml0KHRoaXMpO1xuXHRcdH1cblx0fVxuXG5cdG5nT25EZXN0cm95KCkge1xuXHRcdGlmICh0aGlzLm93bmVyU2NvcGUpIHtcblx0XHRcdHRoaXMub3duZXJTY29wZS5vbkFjdGlvbkRlc3Ryb3kodGhpcyk7XG5cdFx0fVxuXHR9XG59XG5cbkBEaXJlY3RpdmUoe1xuXHRzZWxlY3RvcjogJ05hdmlnYXRpb25CdXR0b24nLCAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOmRpcmVjdGl2ZS1zZWxlY3RvclxufSlcbmV4cG9ydCBjbGFzcyBOYXZpZ2F0aW9uQnV0dG9uRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95IHtcblx0Y29uc3RydWN0b3IocHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIEBPcHRpb25hbCgpIHByaXZhdGUgb3duZXJTY29wZTogQWN0aW9uQmFyU2NvcGUpIHtcblx0XHRpZiAodGhpcy5vd25lclNjb3BlKSB7XG5cdFx0XHR0aGlzLm93bmVyU2NvcGUub25OYXZCdXR0b25Jbml0KHRoaXMpO1xuXHRcdH1cblx0fVxuXG5cdG5nT25EZXN0cm95KCkge1xuXHRcdGlmICh0aGlzLm93bmVyU2NvcGUpIHtcblx0XHRcdHRoaXMub3duZXJTY29wZS5vbk5hdkJ1dHRvbkRlc3Ryb3kodGhpcyk7XG5cdFx0fVxuXHR9XG59XG4iXX0=